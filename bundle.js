(()=>{var t={447:()=>{document.addEventListener("DOMContentLoaded",(function(){const t={firebaseConfig:window.firebaseConfig||{},firebaseAuth:null,db:null,init:function(){if(!firebase.apps.length){if(!this.firebaseConfig.apiKey)return console.error("Firebase configuration is missing. Please check your firebaseConfig.js file."),{firebaseAuth:null,db:null};firebase.initializeApp(this.firebaseConfig)}return this.firebaseAuth=firebase.auth(),this.db=firebase.firestore(),{firebaseAuth:this.firebaseAuth,db:this.db}},auth:{login:async function(e,n){try{return await t.firebaseAuth.signInWithEmailAndPassword(e,n)}catch(t){throw t}},logout:async function(){try{return await t.firebaseAuth.signOut()}catch(t){throw t}},getCurrentUser:function(){return t.firebaseAuth.currentUser},onAuthStateChanged:function(e){return t.firebaseAuth.onAuthStateChanged(e)}},posts:{create:async function(e){try{const n=t.auth.getCurrentUser();if(!n)throw new Error("Not authenticated");const o={title:e.title,subtitle:e.subtitle,content:e.content,timestamp:firebase.firestore.FieldValue.serverTimestamp(),authorId:n.uid,authorEmail:n.email};return await t.db.collection("music-posts").add(o)}catch(t){throw t}},getAllPosts:async function(){try{return(await t.db.collection("music-posts").orderBy("timestamp","desc").get()).docs.map((t=>({id:t.id,...t.data()})))}catch(t){throw t}},deletePost:async function(e){try{const n=await t.db.collection("music-posts").doc(e).collection("comments").get(),o=t.db.batch();return n.docs.forEach((t=>{o.delete(t.ref)})),o.delete(t.db.collection("music-posts").doc(e)),await o.commit()}catch(t){throw t}},getPost:async function(e){try{const n=await t.db.collection("music-posts").doc(e).get();if(!n.exists)throw new Error("Post not found");return{id:n.id,...n.data()}}catch(t){throw t}},updatePost:async function(e,n){try{if(!t.auth.getCurrentUser())throw new Error("Not authenticated");return await t.db.collection("music-posts").doc(e).update({title:n.title,subtitle:n.subtitle,content:n.content,updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}catch(t){throw t}}},comments:{getAllComments:async function(){try{const e=await t.db.collection("music-posts").get(),n=[];for(const t of e.docs){const e=(await t.ref.collection("comments").orderBy("timestamp","desc").limit(50).get()).docs.map((e=>({id:e.id,postId:t.id,postTitle:t.data().title,...e.data()})));n.push(...e)}return n.sort(((t,e)=>{const n=t.timestamp?t.timestamp.toDate().getTime():0;return(e.timestamp?e.timestamp.toDate().getTime():0)-n}))}catch(t){throw t}},deleteComment:async function(e,n){try{const o=await t.db.collection("music-posts").doc(e).collection("comments").where("parentId","==",n).get(),s=t.db.batch();return o.docs.forEach((t=>{s.delete(t.ref)})),s.delete(t.db.collection("music-posts").doc(e).collection("comments").doc(n)),await s.commit()}catch(t){throw t}}}},e={elements:{loginView:document.getElementById("login-view"),adminDashboard:document.getElementById("admin-dashboard"),loginForm:document.getElementById("login-form"),postForm:document.getElementById("post-form"),userStatus:document.getElementById("user-status"),errorMessage:document.getElementById("error-message"),successMessage:document.getElementById("success-message"),postsList:document.getElementById("posts-list"),commentsList:document.getElementById("comments-list"),previewContainer:document.getElementById("preview-container"),previewContent:document.getElementById("preview-content"),logoutBtn:document.getElementById("logout-btn"),tabPosts:document.getElementById("tab-posts"),tabComments:document.getElementById("tab-comments"),postsTab:document.getElementById("posts-tab"),commentsTab:document.getElementById("comments-tab"),email:document.getElementById("email"),password:document.getElementById("password"),postTitle:document.getElementById("post-title"),postSubtitle:document.getElementById("post-subtitle"),postContent:document.getElementById("post-content")},init:function(){this.initMarkdownEditor()},initMarkdownEditor:function(){this.simpleMDE=new SimpleMDE({element:e.elements.postContent,spellChecker:!1,status:!1,toolbar:["bold","italic","heading","|","unordered-list","ordered-list","|","link","image","|","preview","guide"],previewRender:function(t){let e=marked.parse(t);return e=e.replace(/!\[video\]\((https:\/\/(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([a-zA-Z0-9_-]+)(?:&\S*)?)\)/g,((t,e,n)=>`<iframe width="100%" height="315" src="https://www.youtube.com/embed/${n}" frameborder="0" allowfullscreen></iframe>`)),e}})},auth:{updateUI:function(t){t?(e.elements.loginView.style.display="none",e.elements.adminDashboard.style.display="block",e.elements.userStatus.textContent=`Logged in as: ${t.email}`):(e.elements.loginView.style.display="block",e.elements.adminDashboard.style.display="none",e.elements.userStatus.textContent="Not logged in")},showError:function(t){e.elements.errorMessage.textContent=t,e.elements.errorMessage.style.display="block",setTimeout((()=>{e.elements.errorMessage.style.display="none"}),5e3)},showSuccess:function(t){e.elements.successMessage.textContent=t,e.elements.successMessage.style.display="block",setTimeout((()=>{e.elements.successMessage.style.display="none"}),5e3)},clearLoginForm:function(){e.elements.loginForm.reset()}},posts:{renderList:function(t){const n=e.elements.postsList;0!==t.length?(n.innerHTML="",t.forEach((t=>{const o=e.posts.createPostElement(t);n.appendChild(o)}))):n.innerHTML="<p>No posts found. Create your first post!</p>"},createPostElement:function(t){const e=document.createElement("div");e.className="post-item",e.setAttribute("data-post-id",t.id);let n="Draft";return t.timestamp&&(n=t.timestamp.toDate().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})),e.innerHTML=`\n                    <div class="post-item-title">${t.title}</div>\n                    <div class="post-item-subtitle">${t.subtitle}</div>\n                    <div class="post-item-date">${n}</div>\n                    <div class="post-item-actions">\n                        <button class="btn edit-post-btn" data-post-id="${t.id}">Edit</button>\n                        <button class="btn delete-post-btn" data-post-id="${t.id}">Delete</button>\n                        <a href="music.html" class="btn" target="_blank">View Live</a>\n                    </div>\n                `,e},clearPostForm:function(){e.elements.postForm.reset(),e.simpleMDE.value("")},fillPostForm:function(t){e.elements.postTitle.value=t.title,e.elements.postSubtitle.value=t.subtitle,e.simpleMDE.value(t.content);const n=e.elements.postForm.querySelector('button[type="submit"]');n.textContent="Update Post",n.setAttribute("data-mode","edit"),n.setAttribute("data-post-id",t.id),e.elements.postForm.scrollIntoView({behavior:"smooth"})},resetPostForm:function(){const t=e.elements.postForm.querySelector('button[type="submit"]');t.textContent="Publish Post",t.removeAttribute("data-mode"),t.removeAttribute("data-post-id"),e.posts.clearPostForm()}},comments:{renderList:function(t,n){const o=document.getElementById(`comments-${t}`);o&&(0!==n.length?(o.innerHTML="",n.forEach((n=>{const s=e.comments.createCommentElement(t,n.id,n);o.appendChild(s)}))):o.innerHTML="<p>No comments yet. Be the first to comment!</p>")},renderReplies:function(t,n,o,s){if(0===o.length)return;const i=document.createElement("div");i.className="replies";const a=o.filter((t=>1===t.level)),r=o.filter((t=>2===t.level));a.forEach((n=>{const o=e.comments.createCommentElement(t,n.id,n,!0);i.appendChild(o);const s=document.createElement("div");s.className="second-level-replies",s.setAttribute("data-parent-id",n.id),o.appendChild(s),r.filter((t=>t.parentId===n.id)).forEach((n=>{const o=e.comments.createCommentElement(t,n.id,n,!0);s.appendChild(o)}))})),s.appendChild(i)},createCommentElement:function(t,e,n,o=!1){const s=document.createElement("div");s.className="comment",s.setAttribute("data-comment-id",e);let i="Just now";n.timestamp&&(i=n.timestamp.toDate().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}));const a=n.authorName?n.authorName:"Anonymous",r=marked.parse(n.content);if(s.innerHTML=`\n                    <div class="comment-header">\n                        <span class="comment-author">${a}</span>\n                        <span class="comment-date">${i}</span>\n                    </div>\n                    <div class="comment-content">\n                        ${r}\n                    </div>\n                `,!o||2!==n.level){const n=document.createElement("button");n.className="btn reply-button",n.textContent="Reply",s.appendChild(n);const i=document.createElement("form");i.className="reply-form",i.style.display="none",i.innerHTML='\n                        <input type="text" placeholder="Your Name (optional)" class="comment-name">\n                        <textarea placeholder="Write your reply here... Markdown supported." class="comment-text" required></textarea>\n                        <button type="submit" class="btn">Post Reply</button>\n                    ',i.setAttribute("data-post-id",t),i.setAttribute("data-parent-id",e),i.setAttribute("data-level",o?"2":"1"),s.appendChild(i)}return s}},tabs:{switchToTab:function(t){e.elements.tabPosts.classList.toggle("active","posts"===t),e.elements.tabComments.classList.toggle("active","comments"===t),e.elements.postsTab.classList.toggle("active","posts"===t),e.elements.commentsTab.classList.toggle("active","comments"===t)}},showError:function(t){alert(t)}};({init:function(){t.init(),e.generateStars(),this.setupEventListeners(),t.auth.onAuthStateChanged((t=>{e.auth.updateUI(t),t&&(this.loadPosts(),this.loadComments())}))},setupEventListeners:function(){e.elements.loginForm.addEventListener("submit",this.handleLogin.bind(this)),e.elements.logoutBtn.addEventListener("click",this.handleLogout.bind(this)),e.elements.postForm.addEventListener("submit",this.handlePostSubmit.bind(this)),e.elements.tabPosts.addEventListener("click",(()=>e.tabs.switchToTab("posts"))),e.elements.tabComments.addEventListener("click",(()=>e.tabs.switchToTab("comments"))),e.elements.postsList.addEventListener("click",this.handlePostAction.bind(this)),e.elements.commentsList.addEventListener("click",this.handleCommentAction.bind(this))},handleLogin:async function(n){n.preventDefault();const o=e.elements.email.value,s=e.elements.password.value;try{await t.auth.login(o,s),e.auth.clearLoginForm()}catch(t){e.auth.showError("Login failed: "+t.message)}},handleLogout:async function(){try{await t.auth.logout()}catch(t){e.auth.showError("Error signing out: "+t.message)}},handlePostSubmit:async function(n){n.preventDefault();const o=e.elements.postTitle.value,s=e.elements.postSubtitle.value,i=e.simpleMDE.value(),a=n.target.querySelector('button[type="submit"]'),r="edit"===a.getAttribute("data-mode");try{if(r){const n=a.getAttribute("data-post-id");await t.posts.updatePost(n,{title:o,subtitle:s,content:i}),e.auth.showSuccess("Post updated successfully!")}else await t.posts.create({title:o,subtitle:s,content:i}),e.auth.showSuccess("Post created successfully!");e.posts.resetPostForm(),this.loadPosts()}catch(t){e.auth.showError("Error saving post: "+t.message)}},loadPosts:async function(){try{const n=await t.posts.getAllPosts();e.posts.renderList(n)}catch(t){e.auth.showError("Error loading posts: "+t.message),e.posts.renderList([])}},handlePostAction:async function(n){if(n.target.classList.contains("edit-post-btn")){const o=n.target.getAttribute("data-post-id");try{const n=await t.posts.getPost(o);e.posts.fillPostForm(n)}catch(t){e.auth.showError("Error loading post: "+t.message)}}if(n.target.classList.contains("delete-post-btn")){const o=n.target.getAttribute("data-post-id");if(confirm("Are you sure you want to delete this post? This action cannot be undone."))try{await t.posts.deletePost(o),e.auth.showSuccess("Post deleted successfully!"),this.loadPosts()}catch(t){e.auth.showError("Error deleting post: "+t.message)}}},loadComments:async function(){try{(await t.comments.getAllComments()).forEach((t=>{e.comments.renderList(t.postId,[t])}))}catch(t){e.auth.showError("Error loading comments: "+t.message)}},handleCommentAction:async function(n){if(n.target.classList.contains("delete-comment-btn")){const o=n.target.getAttribute("data-comment-id"),s=n.target.getAttribute("data-post-id");if(confirm("Are you sure you want to delete this comment? This action cannot be undone."))try{await t.comments.deleteComment(s,o),e.auth.showSuccess("Comment deleted successfully!"),this.loadComments()}catch(t){e.auth.showError("Error deleting comment: "+t.message)}}},handleCommentSubmit:async function(n){const o=n.getAttribute("data-post-id");if("welcome"===o)return void e.showError("Cannot add comments to the default post. Create a new post as admin first.");const s=n.querySelector(".comment-name"),i=n.querySelector(".comment-text"),a=s.value.trim(),r=i.value.trim();if(r)try{await t.comments.create(o,{authorName:a,content:r,parentId:null,level:0}),n.reset(),this.loadComments(o)}catch(t){e.showError("Error adding comment: "+t.message)}else e.showError("Please enter a comment")},handleReplySubmit:async function(n){const o=n.getAttribute("data-post-id"),s=n.getAttribute("data-parent-id"),i=parseInt(n.getAttribute("data-level")),a=n.querySelector(".comment-name"),r=n.querySelector(".comment-text"),c=a.value.trim(),l=r.value.trim();if(l)try{await t.comments.create(o,{authorName:c,content:l,parentId:s,level:i}),n.reset(),n.style.display="none",this.loadComments(o)}catch(t){e.showError("Error adding reply: "+t.message)}else e.showError("Please enter a reply")}}).init()}))}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}(()=>{"use strict";const t={apiKey:"AIzaSyDr7FIH1opjv7oVK4JJEEPmRWxc9krqRBM",authDomain:"music-proj-fd214.firebaseapp.com",projectId:"music-proj-fd214",storageBucket:"music-proj-fd214.firebasestorage.app",messagingSenderId:"202310638197",appId:"1:202310638197:web:eeee495a784423f7d8363c",measurementId:"G-95818P8QXE"};window.firebaseConfig=t;const e=t;document.addEventListener("DOMContentLoaded",(function(){console.log("Verifying firebaseConfig file..."),window.firebaseConfig&&window.firebaseConfig.apiKey?console.log("Firebase configuration loaded successfully:",window.firebaseConfig):console.error("Firebase configuration is missing or not loaded properly. Please check that firebaseConfig.js is in the correct location.");const t={firebaseConfig:e,firebaseAuth:null,db:null,init:function(){if(!firebase.apps.length){if(!this.firebaseConfig.apiKey)return console.error("Firebase configuration is missing. Please check your firebaseConfig.js file."),{firebaseAuth:null,db:null};firebase.initializeApp(this.firebaseConfig)}return this.firebaseAuth=firebase.auth(),this.db=firebase.firestore(),{firebaseAuth:this.firebaseAuth,db:this.db}},auth:{login:async function(e,n){try{return await t.firebaseAuth.signInWithEmailAndPassword(e,n)}catch(t){throw t}},logout:async function(){try{return await t.firebaseAuth.signOut()}catch(t){throw t}},getCurrentUser:function(){return t.firebaseAuth.currentUser},onAuthStateChanged:function(e){return t.firebaseAuth.onAuthStateChanged(e)}},posts:{create:async function(e){try{const n=t.auth.getCurrentUser();if(!n)throw new Error("Not authenticated");const o={title:e.title,subtitle:e.subtitle,content:e.content,thumbnail:e.thumbnail||"",timestamp:firebase.firestore.FieldValue.serverTimestamp(),authorId:n.uid,authorEmail:n.email,pinned:e.pinned||!1};return await t.db.collection("music-posts").add(o)}catch(t){throw t}},update:async function(e,n){try{if(!t.auth.getCurrentUser())throw new Error("Not authenticated");const o={title:n.title,subtitle:n.subtitle,content:n.content,thumbnail:n.thumbnail||"",pinned:n.pinned||!1,lastEdited:firebase.firestore.FieldValue.serverTimestamp()};return await t.db.collection("music-posts").doc(e).update(o)}catch(t){throw console.error("Error updating post:",t),t}},getAllPosts:async function(){try{return(await t.db.collection("music-posts").orderBy("pinned","desc").orderBy("timestamp","desc").get()).docs.filter((t=>"site-data"!==t.id)).map((t=>({id:t.id,...t.data()})))}catch(t){throw t}},getPaginatedPosts:async function(e=1,n=10){try{const o=(await t.db.collection("music-posts").orderBy("pinned","desc").orderBy("timestamp","desc").get()).docs.filter((t=>"site-data"!==t.id)),s=o.length,i=Math.ceil(s/n);e>i&&i>0&&(e=i);const a=(e-1)*n;return{posts:o.slice(a,a+n).map((t=>({id:t.id,...t.data()}))),currentPage:e,totalPages:i,totalPosts:s}}catch(t){throw t}},getPost:async function(e){try{const n=await t.db.collection("music-posts").doc(e).get();if(!n.exists)throw new Error("Post not found");return{id:n.id,...n.data()}}catch(t){throw t}},deletePost:async function(e){try{if(!t.auth.getCurrentUser())throw new Error("Not authenticated");const n=await t.db.collection("music-posts").doc(e).collection("comments").get(),o=t.db.batch();return n.docs.forEach((t=>{o.delete(t.ref)})),o.delete(t.db.collection("music-posts").doc(e)),await o.commit()}catch(t){throw console.error("Error deleting post:",t),t}}},comments:{create:async function(e,n){try{const o=await fetch("https://api.ipify.org?format=json"),s=(await o.json()).ip,i={authorName:n.authorName||"Anonymous",content:n.content,timestamp:firebase.firestore.FieldValue.serverTimestamp(),parentId:n.parentId||null,ancestors:n.ancestors||[],depth:n.depth||0,authorIp:s,likes:0,likedIps:[]};return await t.db.collection("music-posts").doc(e).collection("comments").add(i)}catch(t){throw t}},getThreadForComment:async function(e,n){try{const o=await t.db.collection("music-posts").doc(e).collection("comments").doc(n).get();if(!o.exists)throw new Error("Comment not found");const s={id:o.id,...o.data()},i=(await t.db.collection("music-posts").doc(e).collection("comments").where("ancestors","array-contains",n).orderBy("depth","asc").orderBy("timestamp","asc").get()).docs.map((t=>({id:t.id,...t.data()})));let a=[];return s.ancestors&&s.ancestors.length>0&&(a=(await t.db.collection("music-posts").doc(e).collection("comments").where(firebase.firestore.FieldPath.documentId(),"in",s.ancestors).get()).docs.map((t=>({id:t.id,...t.data()})))),{comment:s,replies:i,ancestors:a}}catch(t){throw t}},deleteComment:async function(e,n){try{const o=await fetch("https://api.ipify.org?format=json"),s=(await o.json()).ip,i=t.db.collection("music-posts").doc(e).collection("comments").doc(n),a=await i.get();if(!a.exists)throw new Error("Comment not found");const r=a.data().authorIp===s,c=null!==t.auth.getCurrentUser();if(!r&&!c)throw new Error("You can only delete your own comments");if(r&&!c)return await i.update({content:"[Comment deleted by author]",deletedByAuthor:!0,originalContent:a.data().content}),{updated:!0};if(c)return await i.update({content:"[Comment deleted by admin]",deletedByAdmin:!0,originalContent:a.data().content}),{updated:!0}}catch(t){throw console.error("Error deleting comment:",t),t}},getRecentComments:async function(e,n=3){try{return(await t.db.collection("music-posts").doc(e).collection("comments").where("parentId","==",null).orderBy("timestamp","desc").limit(n).get()).docs.map((t=>({id:t.id,...t.data()})))}catch(t){throw t}},likeComment:async function(e,n){try{const o=await fetch("https://api.ipify.org?format=json"),s=(await o.json()).ip,i=t.db.collection("music-posts").doc(e).collection("comments").doc(n),a=await i.get();if(!a.exists)throw new Error("Comment not found");const r=a.data().likes||0,c=a.data().likedIps||[],l=a.data().authorIp||null;return c.includes(s)||s===l?{alreadyLiked:!0,isAuthor:s===l}:await i.update({likes:r+1,likedIps:firebase.firestore.FieldValue.arrayUnion(s)})}catch(t){throw console.error("Error in likeComment:",t),t}},getTopLikedComments:async function(e,n=3){try{return(await t.db.collection("music-posts").doc(e).collection("comments").where("parentId","==",null).orderBy("likes","desc").limit(n).get()).docs.map((t=>({id:t.id,...t.data()})))}catch(t){throw t}},getTopLevelComments:async function(e){try{return(await t.db.collection("music-posts").doc(e).collection("comments").where("parentId","==",null).orderBy("timestamp","desc").get()).docs.map((t=>({id:t.id,...t.data()})))}catch(t){throw t}},getReplies:async function(e,n){try{return(await t.db.collection("music-posts").doc(e).collection("comments").where("parentId","==",n).orderBy("timestamp","desc").get()).docs.map((t=>({id:t.id,...t.data()})))}catch(t){throw t}}},visitors:{recordVisit:async function(){try{const e=await fetch("https://api.ipify.org?format=json"),n=(await e.json()).ip,o="site-data",s=t.db.collection("music-posts").doc(o);(await s.get()).exists||await s.set({title:"Site Data",subtitle:"Technical document for site metrics",content:"This document stores site-wide data and metrics.",timestamp:firebase.firestore.FieldValue.serverTimestamp()});const i=s.collection("visitors");if((await i.doc(n).get()).exists)await i.doc(n).update({lastVisit:firebase.firestore.FieldValue.serverTimestamp(),visits:firebase.firestore.FieldValue.increment(1)});else{await i.doc(n).set({firstVisit:firebase.firestore.FieldValue.serverTimestamp(),visits:1});const t=s.collection("counters").doc("visitors");await t.set({count:firebase.firestore.FieldValue.increment(1)},{merge:!0})}return await this.getVisitorCount()}catch(t){return console.error("Error recording visitor:",t),null}},getVisitorCount:async function(){try{const e="site-data",n=await t.db.collection("music-posts").doc(e).collection("counters").doc("visitors").get();return n.exists?n.data().count:(await t.db.collection("music-posts").doc(e).collection("counters").doc("visitors").set({count:0}),0)}catch(t){return console.error("Error getting visitor count:",t),null}}}},n={elements:{loginBtn:document.getElementById("login-btn"),logoutBtn:document.getElementById("logout-btn"),userStatus:document.getElementById("user-status"),adminPanel:document.getElementById("admin-panel"),loginModal:document.getElementById("login-modal"),closeLoginBtn:document.getElementById("close-login"),adminLoginForm:document.getElementById("admin-login-form"),postForm:document.getElementById("post-form"),musicPostsContainer:document.getElementById("music-posts")},generateStars:function(){const t=document.getElementById("stars");if(!t)return;for(let e=0;e<200;e++){const e=document.createElement("div"),n=2*Math.random();e.style.position="absolute",e.style.width=`${n}px`,e.style.height=`${n}px`,e.style.backgroundColor="white",e.style.borderRadius="50%",e.style.left=100*Math.random()+"%",e.style.top=100*Math.random()+"%",e.style.opacity=Math.random(),Math.random()>.7&&(e.style.animation=`blink ${2+3*Math.random()}s infinite`),t.appendChild(e)}const e=document.querySelector(".marquee-content");if(e){const t=e.textContent.trim();document.body.classList.contains("animations-disabled")||(e.textContent=t+" • "+t+" • "+t,e.style.animationDelay="0s")}},auth:{updateUI:function(t){t?(n.elements.userStatus.textContent=`Logged in as Admin (${t.email})`,n.elements.loginBtn.style.display="none",n.elements.logoutBtn.style.display="inline-block",n.elements.adminPanel.style.display="block"):(n.elements.userStatus.textContent="Not logged in",n.elements.loginBtn.style.display="inline-block",n.elements.logoutBtn.style.display="none",n.elements.adminPanel.style.display="none")},showLoginModal:function(){n.elements.loginModal.style.display="flex"},hideLoginModal:function(){n.elements.loginModal.style.display="none"},clearLoginForm:function(){n.elements.adminLoginForm.reset()}},posts:{renderAll:function(t){const e=n.elements.musicPostsContainer,o=document.getElementById("loading-indicator");if(o&&o.remove(),e.innerHTML="",0===t.length){const t=document.createElement("div");return t.className="post",t.innerHTML='\n                        <div class="post-header">\n                            <h2 class="post-title">No Posts Yet</h2>\n                            <h3 class="post-subtitle">Stay tuned for upcoming music content</h3>\n                        </div>\n                        <div class="post-content">\n                            <p>The admin hasn\'t added any music posts yet. Check back soon!</p>\n                        </div>\n                    ',void e.appendChild(t)}t.forEach((t=>{const o=n.posts.createPostElement(t.id,t);e.appendChild(o)}))},createPostElement:function(e,n,o=!0){const s=document.createElement("div");s.className="post",s.setAttribute("data-post-id",e);let i="Just now";n.timestamp&&(i=n.timestamp.toDate().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}));let a=marked.parse(n.content);a=a.replace(/!\[video\]\((https:\/\/(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([a-zA-Z0-9_-]+)(?:&\S*)?)\)/g,((t,e,n)=>`<iframe width="100%" height="315" src="https://www.youtube.com/embed/${n}" frameborder="0" allowfullscreen></iframe>`));let r="";r=n.thumbnail?`<img src="${n.thumbnail}" alt="Thumbnail">`:this.extractThumbnail(a);let c=a,l=!1;if(o){const t=document.createElement("div");t.innerHTML=a,l=t.textContent.length>200;let e=a;if(l){const t=document.createElement("div");t.innerHTML=a;let n=0,o=Array.from(t.childNodes),s=[];for(let t of o){if(n>=200)break;if(t.nodeType===Node.TEXT_NODE){if(!(t.textContent.length+n<=200)){const e=document.createTextNode(t.textContent.slice(0,200-n));s.push(e),n=200;break}s.push(t.cloneNode(!0)),n+=t.textContent.length}else t.nodeType===Node.ELEMENT_NODE&&(s.push(t.cloneNode(!0)),n+=t.textContent.length)}const i=document.createElement("div");s.forEach((t=>i.appendChild(t))),e=i.innerHTML+"..."}c=`\n                        <div class="post-preview">\n                            ${r?`<div class="post-thumbnail">${r}</div>`:""}\n                            <div class="post-preview-text">\n                                ${e}\n                            </div>\n                        </div>\n                    `}let d="";n.pinned&&(d='<div class="pinned-indicator">📌 Pinned Post</div>');let m=`\n                    <div class="post-header">\n                        ${d}\n                        <h2 class="post-title" data-post-id="${e}">${n.title}</h2>\n                        <h3 class="post-subtitle">${n.subtitle}</h3>\n                        <div class="post-date">${i}</div>\n                    </div>\n                `;if(!o&&r&&(m+=`\n                        <div class="post-thumbnail-full">\n                            ${r}\n                        </div>\n                    `),m+=`\n                    <div class="post-content">\n                        ${o?c:a}\n                    </div>\n                `,o?(m+='<div class="action-buttons-container">',l&&(m+=`\n                            <button class="btn read-more-btn" data-post-id="${e}">Read More</button>\n                        `),m+=`\n                        <button class="btn comment-btn" data-post-id="${e}">Add a comment</button>\n                    </div>\n                    `):m+=`\n                        <div class="comments-section">\n                            <h3 class="comments-title">Comments</h3>\n                            <div class="comments-list" id="comments-${e}">\n                                \x3c!-- Comments will be loaded here --\x3e\n                            </div>\n                            <form class="comment-form" data-post-id="${e}">\n                                <input type="text" placeholder="Your Name (optional)" class="comment-name">\n                                <textarea placeholder="Write your comment here... Markdown supported." class="comment-text" required></textarea>\n                                <button type="submit" class="btn">Post Comment</button>\n                            </form>\n                        </div>\n                    `,o&&setTimeout((()=>{this.showTopComments(e,s)}),100),s.innerHTML=m,t.auth.getCurrentUser()){const t=document.createElement("div");t.className="admin-actions",t.style.marginTop="20px",t.style.textAlign="right";const i=document.createElement("button");i.className="btn edit-post-btn",i.setAttribute("data-post-id",e),i.textContent="Edit Post";const a=document.createElement("button");a.className="btn toggle-pin-btn",a.setAttribute("data-post-id",e),a.textContent=n.pinned?"Unpin Post":"Pin Post";const r=document.createElement("button");if(r.className="btn delete-post-btn",r.setAttribute("data-post-id",e),r.textContent="Delete Post",t.appendChild(i),t.appendChild(a),t.appendChild(r),o){const e=s.querySelector(".action-buttons-container");e?e.appendChild(t):s.appendChild(t)}else s.appendChild(t)}return s},createEditForm:function(){const t=document.createElement("div");t.className="admin-panel edit-panel",t.id="edit-post-panel",t.style.display="none";const e=document.createElement("form");return e.id="edit-post-form",e.className="post-form",e.innerHTML='\n                    <h2 class="admin-title">Edit Post</h2>\n                    <input type="hidden" id="edit-post-id">\n                    \n                    <label for="edit-post-title">Title:</label>\n                    <input type="text" id="edit-post-title" required>\n                    \n                    <label for="edit-post-subtitle">Subtitle:</label>\n                    <input type="text" id="edit-post-subtitle" required>\n                    \n                    <label for="edit-post-thumbnail">Thumbnail URL (optional):</label>\n                    <input type="text" id="edit-post-thumbnail" placeholder="https://example.com/image.jpg">\n                    \n                    <label for="edit-post-content">Content (Markdown supported):</label>\n                    <textarea id="edit-post-content" placeholder="Write your post here. Markdown supported. The first image will be used as thumbnail if no URL is provided. For YouTube videos, use: ![video](youtube-url)" required></textarea>\n                    \n                    <label for="edit-post-pinned" class="checkbox-label">\n                        <input type="checkbox" id="edit-post-pinned"> Pin this post to the top\n                    </label>\n                    \n                    <div class="form-actions">\n                        <button type="button" id="cancel-edit-btn" class="btn">Cancel</button>\n                        <button type="submit" class="btn">Update Post</button>\n                    </div>\n                ',t.appendChild(e),t},populateEditForm:function(t){document.getElementById("edit-post-id").value=t.id,document.getElementById("edit-post-title").value=t.title,document.getElementById("edit-post-subtitle").value=t.subtitle,document.getElementById("edit-post-thumbnail").value=t.thumbnail||"",document.getElementById("edit-post-content").value=t.content,document.getElementById("edit-post-pinned").checked=t.pinned||!1},showEditForm:function(t){n.elements.adminPanel.style.display="none",this.populateEditForm(t);let e=document.getElementById("edit-post-panel");e||(e=this.createEditForm(),document.querySelector("main").insertBefore(e,n.elements.musicPostsContainer));const s=document.getElementById("edit-post-form"),i=s.cloneNode(!0);s.parentNode&&s.parentNode.replaceChild(i,s),i.addEventListener("submit",(function(t){t.preventDefault(),o.handleEditPost(t)}));const a=document.getElementById("cancel-edit-btn");a&&a.addEventListener("click",(function(){n.posts.hideEditForm()})),e.style.display="block",e.scrollIntoView({behavior:"smooth"})},hideEditForm:function(){const t=document.getElementById("edit-post-panel");t&&(t.style.display="none"),n.elements.adminPanel.style.display="block"},renderPaginated:function(t){const{posts:e,currentPage:o,totalPages:s}=t,i=n.elements.musicPostsContainer,a=document.getElementById("loading-indicator");if(a&&a.remove(),i.innerHTML="",0===e.length){const t=document.createElement("div");return t.className="post",t.innerHTML='\n                        <div class="post-header">\n                            <h2 class="post-title">No Posts Yet</h2>\n                            <h3 class="post-subtitle">Stay tuned for upcoming music content</h3>\n                        </div>\n                        <div class="post-content">\n                            <p>The admin hasn\'t added any music posts yet. Check back soon!</p>\n                        </div>\n                    ',void i.appendChild(t)}const r=document.createDocumentFragment();if(e.forEach((t=>{const e=this.createPostElement(t.id,t);e.style.opacity="0",r.appendChild(e)})),i.appendChild(r),s>1){const t=this.createPaginationElement(o,s);i.appendChild(t)}i.querySelectorAll(".post:not(.pagination-container)").forEach(((t,e)=>{setTimeout((()=>{t.style.opacity="1"}),50*e)}))},createPaginationElement:function(t,e){const n=document.createElement("div");n.className="pagination-container post";let o='<div class="pagination">';t>1&&(o+=`<button class="btn pagination-btn prev-page" data-page="${t-1}">Previous</button>`);let s=Math.max(1,t-Math.floor(2.5)),i=Math.min(e,s+5-1);i-s+1<5&&(s=Math.max(1,i-5+1)),s>1&&(o+='<button class="btn pagination-number" data-page="1">1</button>',s>2&&(o+='<span class="pagination-ellipsis">...</span>'));for(let e=s;e<=i;e++)o+=e===t?`<span class="pagination-number current">${e}</span>`:`<button class="btn pagination-number" data-page="${e}">${e}</button>`;return i<e&&(i<e-1&&(o+='<span class="pagination-ellipsis">...</span>'),o+=`<button class="btn pagination-number" data-page="${e}">${e}</button>`),t<e&&(o+=`<button class="btn pagination-btn next-page" data-page="${t+1}">Next</button>`),o+="</div>",n.innerHTML=o,n},showTopComments:async function(e,n){try{let o=await t.comments.getTopLikedComments(e,3);o=o.filter((t=>!t.deletedByAuthor&&!t.deletedByAdmin&&null===t.parentId));let s=[];if(o.length<3&&(s=await t.comments.getRecentComments(e,3-o.length),s=s.filter((t=>!t.deletedByAuthor&&!t.deletedByAdmin)),o.length>0)){const t=o.map((t=>t.id));s=s.filter((e=>!t.includes(e.id)))}const i=[...o,...s];if(0===i.length)return;let a=null;try{const t=await fetch("https://api.ipify.org?format=json"),e=await t.json();a=e.ip}catch(t){console.error("Could not get user IP:",t)}const r=document.createElement("div");r.className="top-comments-section",r.innerHTML=`\n                        <h4 class="top-comments-title">\n                            ${o.length>0?"Popular Comments":"Recent Comments"}\n                        </h4>\n                    `;const c=document.createElement("div");c.className="top-comments-list",i.filter((t=>null===t.parentId)).forEach((t=>{const n=this.createPreviewCommentElement(e,t,a);c.appendChild(n)})),r.appendChild(c);const l=document.createElement("div");l.className="view-all-comments",l.innerHTML=`\n                        <button class="btn comment-btn" data-post-id="${e}">\n                            View All Comments\n                        </button>\n                    `,r.appendChild(l);const d=n.querySelector(".post-actions")||n.querySelector(".preview-comment-link");d?d.parentNode.insertBefore(r,d.nextSibling):n.appendChild(r)}catch(t){console.error("Error loading preview comments:",t)}},createPreviewCommentElement:function(t,e,n=null){const o=document.createElement("div");o.className="comment preview-comment",o.setAttribute("data-comment-id",e.id);let s="Just now";e.timestamp&&(s=e.timestamp.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric"}));const i=e.authorName?e.authorName:"Anonymous";let a=e.content;a.length>100&&(a=a.substring(0,100)+"...");const r=marked.parse(a),c=(n&&e.authorIp,n&&e.likedIps&&e.likedIps.includes(n),e.likes||0);return o.innerHTML=`\n                    <div class="comment-header">\n                        <span class="comment-author">${i}</span>\n                        <span class="comment-date">${s}</span>\n                    </div>\n                    <div class="comment-content preview">\n                        ${r}\n                    </div>\n                    <div class="comment-actions">\n                        <span class="likes-count">${c} ${1===c?"like":"likes"}</span>\n                    </div>\n                `,o},extractThumbnail:function(t){const e=t.match(/<img[^>]+src="([^"]+)"[^>]*>/);return e?`<img src="${e[1]}" alt="Thumbnail">`:""},showAllPosts:function(){const t=n.elements.musicPostsContainer;t.querySelectorAll(".post-full").forEach((t=>{t.remove()})),t.querySelectorAll(".post").forEach((t=>{t.style.display="block"}))},showFullPost:function(e){const s=n.elements.musicPostsContainer,i=s.querySelector(`.post-full[data-post-id="${e}"]`);if(i)return void i.scrollIntoView({behavior:"smooth"});const a=document.createElement("div");let r;a.id="post-loading-indicator",a.className="post loading-indicator",a.innerHTML='<p>Loading post... <span class="blink">|</span></p>',s.querySelectorAll(".post").forEach((t=>{t.style.opacity="0",t.style.transition="opacity 0.3s"})),setTimeout((()=>{s.innerHTML="",r=setTimeout((()=>{s.appendChild(a)}),1e3),t.posts.getPost(e).then((t=>{r&&clearTimeout(r),a.parentNode&&s.removeChild(a);const n=this.createPostElement(e,t,!1);n.classList.add("post-full"),n.style.opacity="0",n.style.transition="opacity 0.5s";const i=document.createElement("button");i.className="btn back-btn",i.textContent="Back to All Posts",i.addEventListener("click",(t=>{t.preventDefault(),o.navigateToAllPosts(n)})),n.insertBefore(i,n.firstChild),s.innerHTML="",s.appendChild(n),setTimeout((()=>{n.style.opacity="1"}),50),o.loadComments(e),window.location.hash!==`#${e}`&&history.pushState(null,"",`#${e}`)})).catch((t=>{r&&clearTimeout(r),a.parentNode&&s.removeChild(a),n.showError("Error loading post: "+t.message),o.loadPosts()}))}),300)},createDefaultPost:function(){const t=document.createElement("div");return t.className="post",t.innerHTML='\n                    <div class="post-header">\n                        <h2 class="post-title">Welcome to My Music Page!</h2>\n                        <h3 class="post-subtitle">A place to share the songs I enjoy</h3>\n                        <div class="post-date">March 18, 2025</div>\n                    </div>\n                    <div class="post-content">\n                        <p>This is where I\'ll be sharing music I like and thoughts about different artists, albums, and songs.</p>\n                        <p>Stay tuned for upcoming posts, and feel free to leave comments!</p>\n                    </div>\n                    <div class="comments-section">\n                        <h3 class="comments-title">Comments</h3>\n                        <div class="comments-list" id="comments-welcome">\n                            \x3c!-- Comments will appear here --\x3e\n                        </div>\n                        <form class="comment-form" data-post-id="welcome">\n                            <input type="text" placeholder="Your Name (optional)" class="comment-name">\n                            <textarea placeholder="Write your comment here... Markdown supported." class="comment-text" required></textarea>\n                            <button type="submit" class="btn">Post Comment</button>\n                        </form>\n                    </div>\n                ',t},clearPostForm:function(){n.elements.postForm.reset()}},comments:{renderComments:function(t,e,n=null,o=!1,s=null){const i=document.getElementById(`comments-${t}`);if(!i)return;if(0===e.length)return void(i.innerHTML="<p>No comments yet. Be the first to comment!</p>");o||s||(i.innerHTML="");const a=[...o?e:e.filter((t=>null===t.parentId))].sort(((t,e)=>t.id===s?-1:e.id===s?1:t.timestamp&&e.timestamp?e.timestamp.seconds-t.timestamp.seconds:0));s&&!o&&(i.innerHTML=""),a.forEach((e=>{const o=e.id===s,a=this.createCommentElement(t,e.id,e,!1,n);o&&a.classList.add("new-comment"),i.appendChild(a)}))},renderThread:function(t,e,s=null){const i=document.getElementById(`comments-${t}`);if(!i)return;i.innerHTML="";const a=document.createElement("button");a.className="btn back-btn thread-back-btn",a.textContent="Back to all comments",a.addEventListener("click",(()=>{o.loadComments(t)})),i.appendChild(a);const r=n.comments.createCommentElement(t,e.comment.id,e.comment,!1,s);i.appendChild(r);const c={};e.replies.forEach((t=>{c[t.parentId]||(c[t.parentId]=[]),c[t.parentId].push(t)})),this.renderNestedReplies(t,e.comment.id,c,r,s)},renderNestedReplies:function(t,e,n,s,i=null,a=0,r=null){const c=n[e]||[];if(0===c.length)return;const l=document.createElement("div");l.className="replies",l.setAttribute("data-parent-id",e),l.setAttribute("data-depth",a),a>0&&l.classList.add(`depth-${Math.min(a,5)}`),c.forEach((e=>{const s=e.id===r,c=this.createCommentElement(t,e.id,e,!0,i);c.classList.add("nested-reply"),s&&c.classList.add("new-comment"),c.setAttribute("data-depth",a+1),l.appendChild(c);const d=n[e.id]&&n[e.id].length>0;if(d&&a>=3){const n=document.createElement("button");n.className="btn continue-thread-btn",n.textContent="Continue this thread",n.setAttribute("data-comment-id",e.id),n.setAttribute("data-post-id",t),n.addEventListener("click",(()=>{o.loadThread(t,e.id)})),c.appendChild(n)}else d&&this.renderNestedReplies(t,e.id,n,c,i,a+1,r)})),s.appendChild(l)},renderReplies:function(t,e,o,s,i=null){if(0===o.length)return;const a=document.createElement("div");a.className="replies";const r=o.filter((t=>1===t.level)),c=o.filter((t=>2===t.level));r.forEach((e=>{const o=n.comments.createCommentElement(t,e.id,e,!0,i);o.classList.add("first-level-reply"),a.appendChild(o);const s=c.filter((t=>t.parentId===e.id));if(s.length>0){const a=document.createElement("div");a.className="second-level-replies",a.setAttribute("data-parent-id",e.id),s.forEach((e=>{const o=n.comments.createCommentElement(t,e.id,e,!0,i);o.classList.add("second-level-reply"),a.appendChild(o)})),o.after(a)}})),s.appendChild(a)},createCommentElement:function(e,n,o,s=!1,i=null){const a=document.createElement("div");a.className="comment",a.setAttribute("data-comment-id",n),a.setAttribute("data-parent-id",o.parentId||"null"),o.depth&&a.setAttribute("data-depth",o.depth);let r="Just now";o.timestamp&&(r=o.timestamp.toDate().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}));const c=o.authorName?o.authorName:"Anonymous",l=o.deletedByAuthor||o.deletedByAdmin,d=o.deletedByAuthor?"<em>[Comment deleted by author]</em>":o.deletedByAdmin?"<em>[Comment deleted by admin]</em>":marked.parse(o.content),m=o.likes||0,u=i&&o.authorIp===i,p=i&&o.likedIps&&o.likedIps.includes(i);let h="";h=u?`<button class="btn like-btn author-comment" data-post-id="${e}" data-comment-id="${n}" disabled>Your Comment</button>`:p?`<button class="btn like-btn already-liked" data-post-id="${e}" data-comment-id="${n}" disabled>Liked</button>`:`<button class="btn like-btn" data-post-id="${e}" data-comment-id="${n}">Like</button>`;const g=l?"":`<button class="btn reply-button" data-comment-id="${n}">Reply</button>`,b=null!==t.auth.getCurrentUser();let f="";if(l||!u&&!b||(f=`<button class="btn delete-comment-btn" data-post-id="${e}" data-comment-id="${n}">Delete</button>`),a.innerHTML=`\n                    <div class="comment-header">\n                        <span class="comment-author">${c}</span>\n                        <span class="comment-date">${r}</span>\n                    </div>\n                    <div class="comment-content">\n                        ${d}\n                    </div>\n                    <div class="comment-actions">\n                        <span class="likes-count">${m} ${1===m?"like":"likes"}</span>\n                        ${h}\n                        ${g}\n                        ${f}\n                    </div>\n                `,!l){const t=document.createElement("form");t.className="reply-form",t.style.display="none",t.innerHTML='\n                        <input type="text" placeholder="Your Name (optional)" class="comment-name">\n                        <textarea placeholder="Write your reply here... Markdown supported." class="comment-text" required></textarea>\n                        <div class="reply-form-actions">\n                            <button type="button" class="btn cancel-reply-btn">Cancel</button>\n                            <button type="submit" class="btn">Post Reply</button>\n                        </div>\n                    ',t.setAttribute("data-post-id",e),t.setAttribute("data-parent-id",n),o.ancestors?t.setAttribute("data-ancestors",JSON.stringify([...o.ancestors,n])):t.setAttribute("data-ancestors",JSON.stringify([n])),t.setAttribute("data-depth",o.depth?o.depth+1:1),a.appendChild(t)}return a}},tabs:{switchToTab:function(t){n.elements.tabPosts.classList.toggle("active","posts"===t),n.elements.tabComments.classList.toggle("active","comments"===t),n.elements.postsTab.classList.toggle("active","posts"===t),n.elements.commentsTab.classList.toggle("active","comments"===t)}},showError:function(t){alert(t)}},o={currentPage:1,init:function(){t.init(),n.generateStars(),n.elements.editPostPanel=n.posts.createEditForm(),document.querySelector("main").insertBefore(n.elements.editPostPanel,n.elements.musicPostsContainer);const e=document.querySelector(".marquee-content");if(e&&!document.body.classList.contains("animations-disabled")){const t=e.textContent.trim();e.textContent=t+" • "+t+" • "+t}if(this.setupEventListeners(),t.auth.onAuthStateChanged((t=>{n.auth.updateUI(t)})),window.location.hash){const t=window.location.hash.substring(1);n.posts.showFullPost(t)}else this.loadPosts();if("true"===localStorage.getItem("animations-disabled")){e&&(e.textContent="WELCOME TO MY MUSIC PAGE • DISCOVER SONGS I LIKE • SHARE YOUR THOUGHTS"),document.body.classList.add("animations-disabled");const t=document.getElementById("toggle-animations-btn");t&&(t.textContent="Enable Animations")}this.updateVisitorCounter()},setupEventListeners:function(){n.elements.loginBtn.addEventListener("click",(()=>{n.auth.showLoginModal()})),n.elements.closeLoginBtn.addEventListener("click",(()=>{n.auth.hideLoginModal()})),window.addEventListener("click",(t=>{t.target===n.elements.loginModal&&n.auth.hideLoginModal()})),n.elements.adminLoginForm.addEventListener("submit",this.handleAdminLogin.bind(this)),n.elements.logoutBtn.addEventListener("click",this.handleLogout.bind(this)),n.elements.postForm.addEventListener("submit",this.handleCreatePost.bind(this)),document.addEventListener("submit",(t=>{t.target.classList.contains("comment-form")?(t.preventDefault(),this.handleCommentSubmit(t.target)):t.target.classList.contains("reply-form")&&(t.preventDefault(),this.handleReplySubmit(t.target))})),document.addEventListener("click",(t=>{if(t.target.classList.contains("reply-button")){t.preventDefault();const e=t.target.closest(".comment");if(!e)return;const n=e.querySelector(".reply-form");if(!n)return;const o=n.getAttribute("data-post-id"),s=document.querySelector(`.post-full[data-post-id="${o}"] .comment-form`),i="block"===n.style.display;if(document.querySelectorAll(".reply-form").forEach((t=>{t.style.display="none";const e=t.closest(".comment").querySelector(".reply-button");e&&e.classList.remove("active-reply")})),i&&s)return s.style.display="block",s.classList.remove("hidden"),t.target.classList.remove("active-reply"),void(n.style.display="none");s&&(s.style.display="none",s.classList.add("hidden")),n.style.display="block",t.target.classList.add("active-reply"),setTimeout((()=>{const t=n.querySelector("textarea");t&&t.focus()}),100)}})),document.addEventListener("click",(t=>{if(t.target.classList.contains("delete-post-btn")){t.preventDefault();const e=t.target.getAttribute("data-post-id");confirm("Are you sure you want to delete this post? This action cannot be undone and all comments will be lost.")&&this.handleDeletePost(e)}})),document.addEventListener("click",(t=>{if(t.target.classList.contains("delete-comment-btn")){t.preventDefault();const e=t.target.getAttribute("data-post-id"),n=t.target.getAttribute("data-comment-id");confirm("Are you sure you want to delete this comment? This action cannot be undone.")&&this.handleDeleteComment(e,n)}})),document.addEventListener("click",(function(t){if(t.target.classList.contains("toggle-pin-btn")){t.preventDefault();const e=t.target.getAttribute("data-post-id");o.handleTogglePin(e,t.target)}})),document.addEventListener("click",(t=>{if(t.target.classList.contains("pagination-btn")||t.target.classList.contains("pagination-number")){t.preventDefault();const e=parseInt(t.target.getAttribute("data-page"));isNaN(e)||(this.loadPosts(e),n.elements.musicPostsContainer.scrollIntoView({behavior:"smooth"}))}}));const t=document.querySelector(".page-title");if(t&&(t.style.cursor="pointer",t.addEventListener("click",(function(t){if(t.preventDefault(),!window.location.hash)return;o.isNavigating&&(o.isNavigating=!1);const e=document.querySelector(".post-full");e?setTimeout((()=>{o.navigateToAllPosts(e)}),50):setTimeout((()=>{o.navigateToAllPosts()}),50)}))),document.addEventListener("click",(t=>{if(t.target.classList.contains("cancel-reply-btn")){t.preventDefault();const e=t.target.closest(".reply-form");if(!e)return;e.style.display="none";const n=e.closest(".comment");if(n){const t=n.querySelector(".reply-button");t&&t.classList.remove("active-reply")}const o=e.getAttribute("data-post-id"),s=document.querySelector(`.post-full[data-post-id="${o}"] .comment-form`);s&&(s.style.display="block",s.classList.remove("hidden"))}})),document.addEventListener("click",(t=>{if(t.target.classList.contains("continue-thread-btn")){t.preventDefault();const e=t.target.getAttribute("data-comment-id"),n=t.target.getAttribute("data-post-id");e&&n&&o.loadThread(n,e)}})),document.addEventListener("click",(function(t){if(t.target.classList.contains("back-btn")){t.preventDefault(),o.isNavigating&&(o.isNavigating=!1);const e=t.target.closest(".post-full");e&&setTimeout((()=>{o.navigateToAllPosts(e)}),50)}})),document.addEventListener("click",(t=>{if(t.target.classList.contains("edit-post-btn")){t.preventDefault();const e=t.target.getAttribute("data-post-id");this.handleEditPostClick(e)}})),document.addEventListener("click",(t=>{const e=t.target;if(e.classList.contains("read-more-btn")||e.classList.contains("post-title")||e.classList.contains("comment-btn")){let o;if(t.preventDefault(),e.hasAttribute("data-post-id"))o=e.getAttribute("data-post-id");else{const t=e.closest("[data-post-id]");t&&(o=t.getAttribute("data-post-id"))}if(!o)return;if(window.location.hash===`#${o}`){if(e.classList.contains("comment-btn")){const t=document.querySelector(`.post-full[data-post-id="${o}"] .comment-form`);t&&(t.scrollIntoView({behavior:"smooth"}),setTimeout((()=>{const e=t.querySelector("textarea");e&&e.focus()}),500))}return}n.posts.showFullPost(o),e.classList.contains("comment-btn")&&setTimeout((()=>{const t=document.querySelector(`.post-full[data-post-id="${o}"] .comment-form`);t&&(t.scrollIntoView({behavior:"smooth"}),setTimeout((()=>{const e=t.querySelector("textarea");e&&e.focus()}),500))}),800)}})),window.location.hash){const t=window.location.hash.substring(1);n.posts.showFullPost(t)}window.addEventListener("hashchange",(function(){if(window.location.hash){const t=window.location.hash.substring(1);n.posts.showFullPost(t)}else o.loadPosts()})),document.addEventListener("click",(t=>{if(t.target.classList.contains("like-btn")){t.preventDefault();const e=t.target.getAttribute("data-post-id"),n=t.target.getAttribute("data-comment-id");this.handleLikeComment(e,n,t.target)}})),window.addEventListener("popstate",(function(t){if(o.isNavigating)return o._popstateTimeoutId&&clearTimeout(o._popstateTimeoutId),void(o._popstateTimeoutId=setTimeout((()=>{o.isNavigating=!1}),100));o.isNavigating=!0,o._popstateTimeoutId&&clearTimeout(o._popstateTimeoutId),o._popstateTimeoutId=setTimeout((()=>{o.isNavigating=!1}),1500);const e=document.querySelector(".post-full");try{if(e&&!window.location.hash)o.navigateToAllPosts(e);else if(window.location.hash){const t=window.location.hash.substring(1);n.posts.showFullPost(t),setTimeout((()=>{o.isNavigating=!1,o._popstateTimeoutId&&(clearTimeout(o._popstateTimeoutId),o._popstateTimeoutId=null)}),100)}else o.navigateToAllPosts()}catch(t){console.error("Error handling popstate:",t),o.isNavigating=!1,o._popstateTimeoutId&&(clearTimeout(o._popstateTimeoutId),o._popstateTimeoutId=null)}}));const e=document.getElementById("toggle-animations-btn");e&&e.addEventListener("click",(function(){const t=document.body.classList.toggle("animations-disabled");this.textContent=t?"Enable Animations":"Disable Animations",localStorage.setItem("animations-disabled",t);const e=document.querySelector(".marquee-content");e&&(t?e.textContent="WELCOME TO MY MUSIC PAGE • DISCOVER SONGS I LIKE • SHARE YOUR THOUGHTS":function(){const t=document.querySelector(".marquee");if(!t)return;const e=t.parentNode,n=document.createElement("div");n.className="marquee";const o=document.createElement("div");o.className="marquee-content";const s="WELCOME TO MY MUSIC PAGE • DISCOVER SONGS I LIKE • SHARE YOUR THOUGHTS";document.body.classList.contains("animations-disabled")?o.textContent=s:o.textContent=s+" • "+s+" • "+s,n.appendChild(o),e.replaceChild(n,t)}())}))},handleLikeComment:async function(e,o,s){try{const n=await t.comments.likeComment(e,o);if(n&&n.alreadyLiked)return n.isAuthor?(s.disabled=!0,s.classList.add("author-comment"),void(s.textContent="Your Comment")):(s.disabled=!0,s.classList.add("already-liked"),void(s.textContent="Liked"));const i=s.previousElementSibling;let a=parseInt(i.textContent);isNaN(a)&&(a=0),a++,i.textContent=`${a} ${1===a?"like":"likes"}`,s.disabled=!0,s.classList.add("already-liked"),s.textContent="Liked"}catch(t){n.showError("Error liking comment: "+t.message)}},handleTogglePin:async function(e,o){try{const s=await t.posts.getPost(e);await t.posts.update(e,{title:s.title,subtitle:s.subtitle,content:s.content,thumbnail:s.thumbnail||"",pinned:!s.pinned}),o.textContent=s.pinned?"Pin Post":"Unpin Post",window.location.hash===`#${e}`?n.posts.showFullPost(e):this.loadPosts(),n.showError(s.pinned?"Post unpinned successfully!":"Post pinned successfully!")}catch(t){n.showError("Error toggling pin status: "+t.message)}},handleDeletePost:async function(e){try{await t.posts.deletePost(e),window.location.hash="",this.loadPosts(),n.showError("Post deleted successfully")}catch(t){n.showError("Error deleting post: "+t.message)}},handleAdminLogin:async function(e){e.preventDefault();const o=document.getElementById("admin-email").value,s=document.getElementById("admin-password").value;try{await t.auth.login(o,s),n.auth.hideLoginModal(),n.auth.clearLoginForm()}catch(t){n.showError("Login failed: "+t.message)}},handleLogout:async function(){try{await t.auth.logout()}catch(t){n.showError("Error signing out: "+t.message)}},handleEditPostClick:async function(e){try{const o=await t.posts.getPost(e);n.posts.showEditForm(o)}catch(t){n.showError("Error loading post for editing: "+t.message)}},handleEditPost:async function(e){e.preventDefault();const o=document.getElementById("edit-post-id").value,s=document.getElementById("edit-post-title").value,i=document.getElementById("edit-post-subtitle").value,a=document.getElementById("edit-post-content").value,r=document.getElementById("edit-post-thumbnail").value,c=document.getElementById("edit-post-pinned").checked;if(!s.trim()||!i.trim()||!a.trim())return void n.showError("Please fill out all required fields");const l=e.target.querySelector('button[type="submit"]'),d=l.textContent;l.textContent="Updating...",l.disabled=!0;try{console.log("Updating post:",o,{title:s,subtitle:i,content:a,thumbnail:r,pinned:c}),await t.posts.update(o,{title:s,subtitle:i,content:a,thumbnail:r,pinned:c}),console.log("Update successful"),n.posts.hideEditForm(),window.location.hash===`#${o}`?n.posts.showFullPost(o):this.loadPosts(),n.showError("Post updated successfully!")}catch(t){console.error("Error updating post:",t),n.showError("Error updating post: "+t.message)}finally{l.textContent=d,l.disabled=!1}},handleDeleteComment:async function(e,o){try{const n=await t.comments.deleteComment(e,o);if(n&&n.updated){const t=document.querySelector(`.comment[data-comment-id="${o}"] .comment-content`);if(t){t.innerHTML="<em>[Comment deleted by author]</em>";const e=document.querySelector(`.comment[data-comment-id="${o}"] .delete-comment-btn`);e&&(e.style.display="none")}}else this.loadComments(e)}catch(t){n.showError("Error deleting comment: "+t.message)}},handleCreatePost:async function(e){e.preventDefault();const o=document.getElementById("post-title").value,s=document.getElementById("post-subtitle").value,i=document.getElementById("post-content").value,a=document.getElementById("post-thumbnail").value,r=document.getElementById("post-pinned").checked;try{await t.posts.create({title:o,subtitle:s,content:i,thumbnail:a,pinned:r}),n.posts.clearPostForm(),this.loadPosts(),n.showError("Post created successfully!")}catch(t){n.showError("Error creating post: "+t.message)}},updateVisitorCounter:async function(){try{const e=await t.visitors.recordVisit();if(null!==e){const t=document.querySelectorAll(".hit-counter .counter-digits");if(t.length>0){const n=e.toString().padStart(t.length,"0");for(let e=0;e<t.length;e++)t[e].textContent=n[e]}}}catch(t){console.error("Error updating visitor counter:",t)}},loadPosts:async function(e=null){if(null!==e&&(this.currentPage=parseInt(e)),window.location.hash){const t=window.location.hash.substring(1);return void n.posts.showFullPost(t)}const o=n.elements.musicPostsContainer;let s;if(this.isBrowserBackNavigation){this.isBrowserBackNavigation=!1;try{const e=await t.posts.getPaginatedPosts(this.currentPage);o.innerHTML="";const s=document.createDocumentFragment();return e.posts.forEach((t=>{const e=n.posts.createPostElement(t.id,t);s.appendChild(e)})),o.classList.add("history-back"),o.appendChild(s),e.totalPages>1&&o.appendChild(n.posts.createPaginationElement(e.currentPage,e.totalPages)),void setTimeout((()=>{o.classList.remove("history-back")}),800)}catch(t){n.showError("Error loading posts: "+t.message)}}else this.isBackNavigation?(this.isBackNavigation=!1,s=setTimeout((()=>{o.innerHTML='\n                        <div id="loading-indicator" style="text-align: center; margin: 40px 0;">\n                            <p>Loading posts... <span class="blink">|</span></p>\n                        </div>\n                    '}),1e3)):s=setTimeout((()=>{o.innerHTML='\n                        <div id="loading-indicator" style="text-align: center; margin: 40px 0;">\n                            <p>Loading posts... <span class="blink">|</span></p>\n                        </div>\n                    '}),1e3);try{const e=await t.posts.getPaginatedPosts(this.currentPage);s&&clearTimeout(s),this.isBackNavigationComplete?(this.isBackNavigationComplete=!1,o.classList.add("history-back"),n.posts.renderPaginated(e),setTimeout((()=>{o.classList.remove("history-back")}),800)):this.isBackNavigation?(this.isBackNavigation=!1,this.isBackNavigationComplete=!0,o.classList.add("history-back"),n.posts.renderPaginated(e),setTimeout((()=>{o.classList.remove("history-back")}),800)):n.posts.renderPaginated(e)}catch(t){s&&clearTimeout(s),n.showError("Error loading posts: "+t.message),o.innerHTML='\n                    <div class="post" style="text-align: center;">\n                        <div class="post-header">\n                            <h2 class="post-title">Error Loading Posts</h2>\n                        </div>\n                        <div class="post-content">\n                            <p>There was an error loading the posts. Please try again later.</p>\n                            <button id="retry-load" class="btn">Retry</button>\n                        </div>\n                    </div>\n                ';const e=document.getElementById("retry-load");e&&e.addEventListener("click",(()=>this.loadPosts()))}},handleCommentSubmit:async function(e){const o=e.getAttribute("data-post-id");if("welcome"===o)return void n.showError("Cannot add comments to the default post. Create a new post as admin first.");const s=e.querySelector(".comment-name"),i=e.querySelector(".comment-text"),a=s.value.trim(),r=i.value.trim();if(!r)return void n.showError("Please enter a comment");const c=e.querySelector('button[type="submit"]'),l=c.textContent;c.textContent="Posting...",c.disabled=!0;try{const n=await t.comments.create(o,{authorName:a,content:r,parentId:null,level:0});e.reset(),c.textContent=l,c.disabled=!1,this.loadComments(o,!0,n.id)}catch(t){c.textContent=l,c.disabled=!1,n.showError("Error adding comment: "+t.message)}},handleReplySubmit:async function(e){const o=e.getAttribute("data-post-id"),s=e.getAttribute("data-parent-id"),i=e.getAttribute("data-ancestors"),a=parseInt(e.getAttribute("data-depth")),r=e.querySelector(".comment-name"),c=e.querySelector(".comment-text"),l=r.value.trim(),d=c.value.trim();if(d)try{const n=e.querySelector('button[type="submit"]'),r=n.textContent;n.disabled=!0,n.textContent="Posting...";const c=i?JSON.parse(i):[],m=await t.comments.create(o,{authorName:l,content:d,parentId:s,ancestors:c,depth:a});e.reset(),e.style.display="none";const u=e.closest(".comment").querySelector(".reply-button");u&&u.classList.remove("active-reply");const p=document.querySelector(`.post-full[data-post-id="${o}"] .comment-form`);p&&(p.style.display="block",p.classList.remove("hidden"));const h=document.querySelector(".thread-back-btn");if(h){const t=h.nextElementSibling;if(t&&t.hasAttribute("data-comment-id")){const e=t.getAttribute("data-comment-id");await this.loadThread(o,e,m.id)}else await this.loadComments(o,!0,m.id)}else await this.loadComments(o,!0,m.id);n.disabled=!1,n.textContent=r}catch(t){n.showError("Error adding reply: "+t.message);const o=e.querySelector('button[type="submit"]');o.disabled=!1,o.textContent="Post Reply"}else n.showError("Please enter a reply")},navigateToAllPosts:function(e){if(this.isNavigating)return this._navigationTimeoutId&&clearTimeout(this._navigationTimeoutId),void(this._navigationTimeoutId=setTimeout((()=>{this.isNavigating=!1}),100));this.isNavigating=!0,this._navigationTimeoutId&&clearTimeout(this._navigationTimeoutId),this._navigationTimeoutId=setTimeout((()=>{this.isNavigating=!1}),2e3),window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search),e&&(e.style.opacity="0"),setTimeout((()=>{const e=n.elements.musicPostsContainer;for(;e.firstChild;)e.removeChild(e.firstChild);t.posts.getPaginatedPosts(this.currentPage).then((t=>{for(;e.firstChild;)e.removeChild(e.firstChild);const o=document.createDocumentFragment(),s=new Set;t.posts.forEach((t=>{if(s.has(t.id))return void console.warn(`Skipping duplicate post: ${t.id}`);s.add(t.id);const e=n.posts.createPostElement(t.id,t);o.appendChild(e)})),e.appendChild(o),t.totalPages>1&&e.appendChild(n.posts.createPaginationElement(t.currentPage,t.totalPages)),e.classList.add("history-back"),setTimeout((()=>{e.classList.remove("history-back"),this.isNavigating=!1,this._navigationTimeoutId&&(clearTimeout(this._navigationTimeoutId),this._navigationTimeoutId=null)}),800)})).catch((t=>{console.error("Error loading posts:",t),this.isNavigating=!1,this._navigationTimeoutId&&(clearTimeout(this._navigationTimeoutId),this._navigationTimeoutId=null)}))}),300)},loadComments:async function(e,o=!1,s=null){try{const i=document.getElementById(`comments-${e}`);if(!i)return;let a,r;a=document.createElement("div"),a.className="comments-loading-overlay",a.innerHTML='<p>Loading comments... <span class="blink">|</span></p>',r=setTimeout((()=>{i&&(i.insertBefore(a,i.firstChild),setTimeout((()=>a.classList.add("active")),10))}),1e3);const c=await fetch("https://api.ipify.org?format=json"),l=(await c.json()).ip,d=document.querySelector(`.post-full[data-post-id="${e}"] .comment-form`);d&&(d.style.display="block");const m=(await t.db.collection("music-posts").doc(e).collection("comments").orderBy("timestamp","desc").get()).docs.map((t=>({id:t.id,...t.data()})));r&&clearTimeout(r);const u=m.filter((t=>null===t.parentId)),p={};m.forEach((t=>{t.parentId&&(p[t.parentId]||(p[t.parentId]=[]),p[t.parentId].push(t))})),a&&a.parentNode&&(a.classList.remove("active"),setTimeout((()=>{a.parentNode&&a.parentNode.removeChild(a)}),300)),n.comments.renderComments(e,u,l,!1,s),u.forEach((t=>{const o=document.querySelector(`.comment[data-comment-id="${t.id}"]`);o&&n.comments.renderNestedReplies(e,t.id,p,o,l,0,s)})),o&&s&&setTimeout((()=>{const t=document.querySelector(`.comment[data-comment-id="${s}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})}),300)}catch(t){console.error("Error loading comments:",t);const n=document.getElementById(`comments-${e}`);n&&(n.innerHTML='\n                        <div class="error-message">\n                            <p>Error loading comments. Please try again later.</p>\n                        </div>\n                    ')}},togglePinned:async function(e){try{if(!t.auth.getCurrentUser())throw new Error("Not authenticated");const n=await this.getPost(e);return await t.db.collection("music-posts").doc(e).update({pinned:!n.pinned}),!n.pinned}catch(t){throw t}},loadThread:async function(e,o){try{const s=document.getElementById(`comments-${e}`);s&&(s.innerHTML='\n                        <div class="comment-loading">\n                            <p>Loading thread... <span class="blink">|</span></p>\n                        </div>\n                    ');const i=await fetch("https://api.ipify.org?format=json"),a=(await i.json()).ip,r=document.querySelector(`.post-full[data-post-id="${e}"] .comment-form`);r&&(r.style.display="none");const c=await t.db.collection("music-posts").doc(e).collection("comments").doc(o).get();if(!c.exists)throw new Error("Comment not found");const l={id:c.id,...c.data()},d=(await t.db.collection("music-posts").doc(e).collection("comments").where("ancestors","array-contains",o).orderBy("timestamp","asc").get()).docs.map((t=>({id:t.id,...t.data()}))),m={};d.forEach((t=>{m[t.parentId]||(m[t.parentId]=[]),m[t.parentId].push(t)})),s.innerHTML="";const u=document.createElement("button");u.className="btn back-btn thread-back-btn",u.textContent="Back to all comments",u.addEventListener("click",(()=>{this.loadComments(e)})),s.appendChild(u);const p=n.comments.createCommentElement(e,l.id,l,!1,a);s.appendChild(p),n.comments.renderNestedReplies(e,l.id,m,p,a,0)}catch(t){console.error("Error loading thread:",t);const n=document.getElementById(`comments-${e}`);if(n){n.innerHTML='\n                        <div class="error-message">\n                            <p>Error loading thread. <button id="back-to-comments" class="btn">Back to comments</button></p>\n                        </div>\n                    ';const t=document.getElementById("back-to-comments");t&&t.addEventListener("click",(()=>{this.loadComments(e)}))}}}};o.init()})),n(447),console.log("Webpack bundle loaded.")})()})();